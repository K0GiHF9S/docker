From abdb77fb645b0895b10a47bbdd7cbeaaa9546c4f Mon Sep 17 00:00:00 2001
From: Go MAEDA <maeda@farend.jp>
Date: Sat, 25 Nov 2017 13:51:20 +0000
Subject: [PATCH 08/11] Make gantt columns resizable (#20481).

Contributed by Mizuki ISHIKAWA.


git-svn-id: http://svn.redmine.org/redmine/trunk@17026 e93f8b46-1217-0410-a6f0-8f06a7374b81
---
 app/views/gantts/show.html.erb | 12 +++++++-----
 public/javascripts/gantt.js    | 22 ++++++++++++++++++++++
 2 files changed, 29 insertions(+), 5 deletions(-)

diff --git a/app/views/gantts/show.html.erb b/app/views/gantts/show.html.erb
index 8949f4cbc..19d065640 100644
--- a/app/views/gantts/show.html.erb
+++ b/app/views/gantts/show.html.erb
@@ -137,7 +137,6 @@
   <%= content_tag(:div, :style => style, :class => "gantt_subjects_container") do %>
     <%
       style  = ""
-      style += "right:-2px;"
       style += "width: #{subject_width}px;"
       style += "height: #{headers_height}px;"
       style += 'background: #eee;'
@@ -145,7 +144,6 @@
     <%= content_tag(:div, "", :style => style, :class => "gantt_hdr") %>
     <%
       style  = ""
-      style += "right:-2px;"
       style += "width: #{subject_width}px;"
       style += "height: #{t_height}px;"
       style += 'border-left: 1px solid #c0c0c0;'
@@ -274,7 +272,7 @@
      wday = 1 if wday > 7
     %>
   <% end %>
-<% end %> 
+<% end %>
 
 <% ###### Days headers ####### %>
 <% if show_days %>
@@ -373,11 +371,15 @@
 
 <%= javascript_tag do %>
   var issue_relation_type = <%= raw Redmine::Helpers::Gantt::DRAW_TYPES.to_json %>;
-  $(document).ready(drawGanttHandler);
-  $(window).resize(drawGanttHandler);
   $(function() {
+    drawGanttHandler();
+    resizableSubjectColumn();
     $("#draw_relations").change(drawGanttHandler);
     $("#draw_progress_line").change(drawGanttHandler);
   });
+  $(window).resize(function() {
+    drawGanttHandler();
+    resizableSubjectColumn();
+  });
 <% end %>
 <%= context_menu %>
diff --git a/public/javascripts/gantt.js b/public/javascripts/gantt.js
index f83eea9f1..2e71178b0 100644
--- a/public/javascripts/gantt.js
+++ b/public/javascripts/gantt.js
@@ -173,3 +173,25 @@ function drawGanttHandler() {
   if ($("#draw_relations").prop('checked'))
     drawRelations();
 }
+
+function resizableSubjectColumn(){
+  $('.issue-subject, .project-name, .version-name').each(function(){
+    $(this).width($(".gantt_subjects_column").width()-$(this).position().left);
+  });
+  $('td.gantt_subjects_column').resizable({
+    alsoResize: '.gantt_subjects_container, .gantt_subjects_container>.gantt_hdr, .project-name, .issue-subject, .version-name',
+    minWidth: 100,
+    handles: 'e',
+    containment: '#content',
+    create: function( event, ui ) {
+      $('.ui-resizable-e').css('cursor','ew-resize');
+    }
+  }).on('resize', function (e) {
+      e.stopPropagation();
+  });
+  if(isMobile()) {
+    $('td.gantt_subjects_column').resizable('disable');
+  }else{
+    $('td.gantt_subjects_column').resizable('enable');
+  };
+}
-- 
2.19.0.windows.1

