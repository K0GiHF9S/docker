From f4b2a4a72dedf05d1a0388bccc9c4a585b4a92de Mon Sep 17 00:00:00 2001
From: Go MAEDA <maeda@farend.jp>
Date: Sat, 25 Nov 2017 16:30:23 +0000
Subject: [PATCH 05/11] Add right-click context menu to gantt subjects
 (#10485).

Contributed by Mizuki ISHIKAWA.


git-svn-id: http://svn.redmine.org/redmine/trunk@17030 e93f8b46-1217-0410-a6f0-8f06a7374b81
---
 app/views/gantts/show.html.erb     | 5 ++++-
 lib/redmine/helpers/gantt.rb       | 3 ++-
 public/stylesheets/application.css | 1 +
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/app/views/gantts/show.html.erb b/app/views/gantts/show.html.erb
index 9a74f72ba..0152c7c11 100644
--- a/app/views/gantts/show.html.erb
+++ b/app/views/gantts/show.html.erb
@@ -153,7 +153,9 @@
     %>
     <%= content_tag(:div, "", :style => style, :class => "gantt_hdr") %>
     <%= content_tag(:div, :class => "gantt_subjects") do %>
-      <%= @gantt.subjects.html_safe %>
+      <%= form_tag({}, :data => {:cm_url => issues_context_menu_path}) do -%>
+        <%= @gantt.subjects.html_safe %>
+      <% end %>
     <% end %>
   <% end %>
 </td>
@@ -376,3 +378,4 @@
     $("#draw_progress_line").change(drawGanttHandler);
   });
 <% end %>
+<%= context_menu %>
diff --git a/lib/redmine/helpers/gantt.rb b/lib/redmine/helpers/gantt.rb
index a4b7a2f39..fc3a6c073 100644
--- a/lib/redmine/helpers/gantt.rb
+++ b/lib/redmine/helpers/gantt.rb
@@ -670,6 +670,7 @@ module Redmine
                              :title => assigned_string).to_s.html_safe
           end
           s << view.link_to_issue(issue).html_safe
+          s << view.content_tag(:input, nil, :type => 'checkbox', :name => 'ids[]', :value => issue.id, :style => 'display:none;', :class => 'toggle-selection')
           view.content_tag(:span, s, :class => css_classes).html_safe
         when Version
           version = object
@@ -704,7 +705,7 @@ module Redmine
         case object
         when Issue
           tag_options[:id] = "issue-#{object.id}"
-          tag_options[:class] = "issue-subject"
+          tag_options[:class] = "issue-subject hascontextmenu"
           tag_options[:title] = object.subject
         when Version
           tag_options[:id] = "version-#{object.id}"
diff --git a/public/stylesheets/application.css b/public/stylesheets/application.css
index 456a3c22b..46b0c81cb 100644
--- a/public/stylesheets/application.css
+++ b/public/stylesheets/application.css
@@ -1149,6 +1149,7 @@ div.wiki img {vertical-align:middle; max-width:100%;}
 
 .gantt_subjects { font-size: 0.8em; }
 .gantt_subjects div { line-height:16px;height:16px;overflow:hidden;white-space:nowrap;text-overflow: ellipsis; }
+.gantt_subjects div.issue-subject:hover { background-color:#ffffdd; }
 
 .gantt_subjects .issue-subject img.icon-gravatar {
   margin: 2px 5px 0px 2px;
-- 
2.19.0.windows.1

