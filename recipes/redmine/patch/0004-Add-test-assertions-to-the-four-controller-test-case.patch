From b1431994ef5969765c6599791b8f501c259a7fd8 Mon Sep 17 00:00:00 2001
From: Jean-Philippe Lang <jp_lang@yahoo.fr>
Date: Sun, 25 Jun 2017 15:17:21 +0000
Subject: [PATCH 04/11] Add test assertions to the four controller test cases
 (#26125).

Patch by Mischa The Evil.

git-svn-id: http://svn.redmine.org/redmine/trunk@16704 e93f8b46-1217-0410-a6f0-8f06a7374b81
---
 test/functional/calendars_controller_test.rb         | 11 +++++++++++
 test/functional/gantts_controller_test.rb            | 12 ++++++++++++
 test/functional/issues_controller_test.rb            | 11 +++++++++++
 .../functional/time_entry_reports_controller_test.rb | 12 ++++++++++++
 4 files changed, 46 insertions(+)

diff --git a/test/functional/calendars_controller_test.rb b/test/functional/calendars_controller_test.rb
index 4454ad4cb..8a45bb364 100644
--- a/test/functional/calendars_controller_test.rb
+++ b/test/functional/calendars_controller_test.rb
@@ -37,6 +37,17 @@ class CalendarsControllerTest < Redmine::ControllerTest
         :project_id => 1
       }
     assert_response :success
+
+    # query form
+    assert_select 'form#query_form' do
+      assert_select 'div#query_form_with_buttons.hide-when-print' do
+        assert_select 'div#query_form_content' do
+          assert_select 'fieldset#filters.collapsible'
+        end
+        assert_select 'p.contextual'
+        assert_select 'p.buttons'
+      end
+    end
   end
 
   def test_show_should_run_custom_queries
diff --git a/test/functional/gantts_controller_test.rb b/test/functional/gantts_controller_test.rb
index d837856a9..063312b76 100644
--- a/test/functional/gantts_controller_test.rb
+++ b/test/functional/gantts_controller_test.rb
@@ -35,6 +35,18 @@ class GanttsControllerTest < Redmine::ControllerTest
       }
     assert_response :success
 
+    # query form
+    assert_select 'form#query_form' do
+      assert_select 'div#query_form_with_buttons.hide-when-print' do
+        assert_select 'div#query_form_content' do
+          assert_select 'fieldset#filters.collapsible'
+          assert_select 'fieldset#options'
+        end
+        assert_select 'p.contextual'
+        assert_select 'p.buttons'
+      end
+    end
+
     # Issue with start and due dates
     i = Issue.find(1)
     assert_not_nil i.due_date
diff --git a/test/functional/issues_controller_test.rb b/test/functional/issues_controller_test.rb
index f88f6f36a..11b37d56c 100644
--- a/test/functional/issues_controller_test.rb
+++ b/test/functional/issues_controller_test.rb
@@ -94,6 +94,17 @@ class IssuesControllerTest < Redmine::ControllerTest
       }
     assert_response :success
 
+    # query form
+    assert_select 'form#query_form' do
+      assert_select 'div#query_form_with_buttons.hide-when-print' do
+        assert_select 'div#query_form_content' do
+          assert_select 'fieldset#filters.collapsible'
+          assert_select 'fieldset#options'
+        end
+        assert_select 'p.buttons'
+      end
+    end
+
     assert_select 'a[href="/issues/1"]', :text => /Cannot print recipes/
     assert_select 'a[href="/issues/5"]', 0
   end
diff --git a/test/functional/time_entry_reports_controller_test.rb b/test/functional/time_entry_reports_controller_test.rb
index 20688c295..196b5e6a4 100644
--- a/test/functional/time_entry_reports_controller_test.rb
+++ b/test/functional/time_entry_reports_controller_test.rb
@@ -37,6 +37,18 @@ class TimeEntryReportsControllerTest < Redmine::ControllerTest
   def test_report_at_project_level
     get :report, :params => {:project_id => 'ecookbook'}
     assert_response :success
+
+    # query form
+    assert_select 'form#query_form' do
+      assert_select 'div#query_form_with_buttons.hide-when-print' do
+        assert_select 'div#query_form_content' do
+          assert_select 'fieldset#filters.collapsible'
+          assert_select 'fieldset#options'
+        end
+        assert_select 'p.buttons'
+      end
+    end
+
     assert_select 'form#query_form[action=?]', '/projects/ecookbook/time_entries/report'
   end
 
-- 
2.19.0.windows.1

